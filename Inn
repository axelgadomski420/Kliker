services:
  - type: web
    name: ad-mine-nginx
    runtime: docker
    dockerfilePath: ./nginx/Dockerfile
    buildCommand: echo "Build nginx"
    startCommand: openresty -g "daemon off;"
    plan: starter
    envVars:
      - key: TARGET_URL
        value: ${{ shared.TARGET_URL }}
      - key: CLICK_RATE
        value: ${{ shared.CLICK_RATE }}
      - key: HUG_TOKEN
        value: ${{ shared.HUG_TOKEN }}
      - key: VPN_CONFIG_PATH
        value: ${{ shared.VPN_CONFIG_PATH }}
      - key: NGINX_URL
        value: https://ad-mine-nginx.onrender.com
    healthCheckPath: /stats

  - type: worker
    name: ad-mine-clicker
    runtime: docker
    dockerfilePath: ./ai-clicker/Dockerfile
    buildCommand: pip install -r requirements.txt
    startCommand: python clicker.py
    plan: starter
    envVars:
      - key: CLICK_RATE
        value: ${{ shared.CLICK_RATE }}
      - key: NGINX_URL
        value: https://ad-mine-nginx.onrender.com
      - key: STRIPE_SECRET
        value: ${{ shared.STRIPE_SECRET }}
      - key: STRIPE_PUBLIC
        value: ${{ shared.STRIPE_PUBLIC }}
      - key: HUG_TOKEN
        value: ${{ shared.HUG_TOKEN }}
      - key: VPN_CONFIG_PATH
        value: ${{ shared.VPN_CONFIG_PATH }}

envVarGroups:
  - name: shared
    envVars:
      - key: TARGET_URL
        value: https://httpbin.org/status/200
      - key: CLICK_RATE
        value: "0.20"               # 20% click rate
      - key: STRIPE_SECRET
        value: sk_test_51S8ZUk7V...
      - key: STRIPE_PUBLIC
        value: pk_test_51S8ZUk7V...
      - key: HUG_TOKEN
        value: hf_icilmGRcbLjuxNsTZg...
      - key: VPN_CONFIG_PATH
        value: /vpnbook/PL134.ovpn  # dostosuj nazwÄ™ pliku
