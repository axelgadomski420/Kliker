<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><title>🚀 ULTIMATE Ad Mining Platform</title>
<style>
  /* ... (bez zmian od poprzedniej wersji) ... */
</style>
</head>
<body>
  <div class="container">
    <h1>🚀 ULTIMATE Ad Mining Platform</h1>
    <!-- statystyki i wykres -->
    <div class="stats">
      <div class="card"><h2 id="imps">0</h2><p>👁️ Impressions</p></div>
      <div class="card"><h2 id="clicks">0</h2><p>🖱️ Clicks</p></div>
      <div class="card"><h2 id="ctr">0%</h2><p>📊 CTR</p></div>
      <div class="card"><h2>$<span id="revenue">0.00</span></h2><p>💰 Revenue</p></div>
    </div>
    <div class="chart-container"><canvas id="revenueChart" width="800" height="300"></canvas></div>
    <div class="controls">
      <div class="control-panel">
        <h3>🎮 Quick Actions</h3>
        <button onclick="manualScan()">⚡ MEGA SCAN</button>
        <button onclick="sendAICommand('toggle_expensive')">💎 Expensive Mode</button>
        <button onclick="sendAICommand('toggle_turbo')">🚀 Turbo Mode</button>
        <button onclick="sendAICommand('toggle_stealth')">🥷 Stealth Mode</button>
        <div id="modes">
          <span class="mode-indicator mode-inactive" id="expensiveMode">💎 Expensive</span>
          <span class="mode-indicator mode-inactive" id="turboMode">🚀 Turbo</span>
          <span class="mode-indicator mode-inactive" id="stealthMode">🥷 Stealth</span>
        </div>
      </div>
      <div class="control-panel">
        <h3>🤖 AI Command Center</h3>
        <div id="chatWindow"></div>
        <input type="text" id="commandInput" placeholder="Enter command..." onkeypress="if(event.key==='Enter') sendAICommand()">
        <button onclick="sendAICommand()">Send Command</button>
      </div>
    </div>
  </div>
  <div id="confetti" class="confetti"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let clickCount = 0, chartData = [];

  function launchConfetti(){
    const c=document.getElementById('confetti');
    for(let i=0;i<50;i++){const p=document.createElement('div');p.className='confetti-piece';
      p.style.backgroundColor=`hsl(${Math.random()*360},70%,60%)`;p.style.left=`${Math.random()*100}%`;
      p.style.setProperty('--dx',(Math.random()*200-100)+'px');p.style.setProperty('--rot',(Math.random()*360)+'deg');
      p.style.animationDelay=(Math.random()*1)+'s';c.appendChild(p);setTimeout(()=>p.remove(),3000);}
  }

  function appendMessage(who,msg){
    const chat=document.getElementById('chatWindow');
    const d=document.createElement('div');
    d.innerHTML=`<strong>[${new Date().toLocaleTimeString()}] ${who}:</strong> ${msg}`;
    d.style.marginBottom='6px';chat.appendChild(d);chat.scrollTop=chat.scrollHeight;
  }

  window.addEventListener('load',()=>appendMessage('AI','Witaj! Wpisz "help" aby zobaczyć komendy.'));

  async function sendAICommand(cmd){
    // Jeśli cmd nie podane, pobierz z inputa
    let text = cmd || document.getElementById('commandInput').value.trim();
    if(!text) return;
    document.getElementById('commandInput').value = '';
    appendMessage('User', text);

    if(text.toLowerCase() === 'help'){
      appendMessage('AI', `Dostępne komendy:
• toggle_expensive – przełącz drogie reklamy
• toggle_turbo – przełącz turbo
• toggle_stealth – przełącz stealth
• set_click_rate <0.05–0.80> – ustaw click_rate
• boost – bonus +$10
• reset – reset statystyk`);
      return;
    }

    try {
      const [action, value] = text.split(' ');
      const res = await fetch('/command', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({action, value})
      });
      const data = await res.json();
      appendMessage('AI', data.message || JSON.stringify(data));
      updateModes(data);
    } catch(e){
      appendMessage('AI', 'Błąd komunikacji');
    }
  }

  function updateModes(data){
    if(data.expensive_mode !== undefined)
      document.getElementById('expensiveMode').className = 'mode-indicator ' + (data.expensive_mode ? 'mode-active':'mode-inactive');
    if(data.turbo_mode !== undefined)
      document.getElementById('turboMode').className = 'mode-indicator ' + (data.turbo_mode ? 'mode-active':'mode-inactive');
    if(data.stealth_mode !== undefined)
      document.getElementById('stealthMode').className = 'mode-indicator ' + (data.stealth_mode ? 'mode-active':'mode-inactive');
  }

  const ctx = document.getElementById('revenueChart').getContext('2d');
  const chart = new Chart(ctx, {
    type:'line',
    data:{labels:[],datasets:[{label:'Revenue',data:[],borderColor:'rgb(75,192,192)',backgroundColor:'rgba(75,192,192,0.1)',tension:0.4}]},
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });

  async function fetchStats(){
    try {
      const res = await fetch('/stats');
      const d = await res.json();
      document.getElementById('imps').textContent = d.imps.toLocaleString();
      document.getElementById('clicks').textContent = d.clicks.toLocaleString();
      document.getElementById('ctr').textContent = d.ctr + '%';
      document.getElementById('revenue').textContent = d.revenue.toFixed(2);
      // update chart
      const now = new Date().toLocaleTimeString();
      chartData.push({t:now,v:d.revenue});
      if(chartData.length>20) chartData.shift();
      chart.data.labels = chartData.map(o=>o.t);
      chart.data.datasets[0].data = chartData.map(o=>o.v);
      chart.update('none');
      if(d.ai_settings) updateModes(d.ai_settings);
    } catch(e){
      console.error('Stats fetch failed:', e);
    }
  }

  async function manualScan(){
    await fetch('/scan',{method:'POST'});
    clickCount++;
    if(clickCount%3===0) launchConfetti();
    appendMessage('System','⚡ MEGA SCAN executed!');
    fetchStats();
  }

  setInterval(fetchStats,3000);
  fetchStats();
</script>
</body>
</html>
