<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad Mining Dashboard</title>
  <style>
    body { font-family: Arial,sans-serif; background: #f5f5f5; margin:0; padding:20px; }
    .stats { display:flex; gap:20px; }
    .card { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); flex:1; text-align:center; }
    .card h2 { margin:0 0 10px; }
    button { padding:10px 20px; border:none; border-radius:4px; background:#007bff; color:#fff; cursor:pointer; }
    button:hover { background:#0056b3; }
  </style>
</head>
<body>
  <h1>Ad Mining Platform</h1>
  <div class="stats">
    <div class="card"><h2 id="imps">0</h2><p>Impressions</p></div>
    <div class="card"><h2 id="clicks">0</h2><p>Clicks</p></div>
    <div class="card"><h2 id="ctr">0%</h2><p>CTR</p></div>
  </div>
  <button onclick="magnet()">Magnes na reklamy</button>
  <button onclick="buy()">Kup reklamÄ™</button>
  <div id="msg" style="margin-top:20px;color:#333;"></div>
  
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    async function fetchStats() {
      const res = await fetch('/stats');
      const data = await res.json();
      document.getElementById('imps').innerText = data.imps;
      document.getElementById('clicks').innerText = data.clicks;
      document.getElementById('ctr').innerText = ((data.clicks/data.imps||0)*100).toFixed(2) + '%';
    }
    async function magnet() {
      const res = await fetch('/scan',{method:'POST'});
      await fetchStats();
      document.getElementById('msg').innerText = 'Magnes uruchomiony!';
    }
    async function buy() {
      const res = await fetch('/stripe/create-payment',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({amount:5.00, success_url:location.href, cancel_url:location.href})
      });
      const {url} = await res.json();
      stripe = Stripe('pk_test_51S8ZUk7Vc44kK9xym9bYMvS1TFJcwqDyzZ3EpDQIY8Syr9S56wMjeVAgnCGcwPm5dIj3Ofoj0lylb6eZ6gCieiC000bIOvtsvr');
      stripe.redirectToCheckout({sessionId: url.split('/').pop()});
    }
    setInterval(fetchStats,5000);
    fetchStats();
  </script>
</body>
</html>
