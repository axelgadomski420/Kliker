<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>üöÄ ULTIMATE Ad Mining Platform</title>
  <style>
    *{box-sizing:border-box;}
    body{font-family:'Segoe UI',Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;margin:0;padding:20px;}
    .container{max-width:1200px;margin:0 auto;}
    h1{text-align:center;font-size:2.5em;margin-bottom:30px;text-shadow:2px 2px 4px rgba(0,0,0,0.3);}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
    .card{background:rgba(255,255,255,0.95);color:#333;padding:25px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.2);text-align:center;transition:transform .3s;}
    .card:hover{transform:translateY(-5px);}
    .card h2{margin:0 0 10px;font-size:2.5em;background:linear-gradient(45deg,#FF6B6B,#4ECDC4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .card p{margin:0;color:#666;font-size:1em;}
    .chart-container{background:rgba(255,255,255,0.95);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 8px 25px rgba(0,0,0,0.2);}
    .controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px;}
    .control-panel{background:rgba(255,255,255,0.95);color:#333;padding:20px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.2);}
    button{padding:12px 25px;border:none;border-radius:8px;background:linear-gradient(45deg,#FF6B6B,#4ECDC4);color:#fff;font-size:1em;cursor:pointer;transition:all .3s;margin:5px;}
    button:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,0.3);}
    #chatWindow{background:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;max-height:300px;overflow-y:auto;padding:15px;margin-bottom:10px;font-family:'Courier New',monospace;color:#333;}
    #commandInput{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:1em;}
    .mode-indicator{display:inline-block;padding:4px 8px;border-radius:4px;font-size:.8em;margin:2px;}
    .mode-active{background:#28a745;color:#fff;}.mode-inactive{background:#6c757d;color:#fff;}
    .confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;}
    .confetti-piece{position:absolute;width:12px;height:8px;opacity:.9;animation:fall 4s linear forwards;}
    @keyframes fall{to{transform:translate(var(--dx),100vh) rotate(var(--rot));opacity:0;}}
    .links-list{list-style:none;padding:0;background:#fff;color:#333;border-radius:8px;max-height:200px;overflow-y:auto;padding:10px;}
    .links-list li{padding:6px;border-bottom:1px solid #ddd;font-size:.9em;}
    #linkModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000;}
    .modal-content{background:#fff;padding:20px;border-radius:8px;color:#333;max-width:400px;width:90%;}
    .modal-content input{width:100%;padding:8px;margin:8px 0;border:1px solid #ccc;border-radius:4px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ ULTIMATE Ad Mining Platform</h1>

    <div class="stats">
      <div class="card"><h2 id="imps">0</h2><p>üëÅÔ∏è Impressions</p></div>
      <div class="card"><h2 id="clicks">0</h2><p>üñ±Ô∏è Clicks</p></div>
      <div class="card"><h2 id="ctr">0%</h2><p>üìä CTR</p></div>
      <div class="card"><h2>$<span id="revenue">0.00</span></h2><p>üí∞ Revenue</p></div>
    </div>

    <div class="chart-container">
      <canvas id="revenueChart"></canvas>
    </div>

    <div class="controls">
      <div class="control-panel">
        <h3>üéÆ Quick Actions</h3>
        <button onclick="manualScan()">‚ö° MEGA SCAN</button>
        <button onclick="sendAICommand('toggle_expensive')">üíé Expensive</button>
        <button onclick="sendAICommand('toggle_turbo')">üöÄ Turbo</button>
        <button onclick="sendAICommand('toggle_stealth')">ü•∑ Stealth</button>
        <div id="modes">
          <span id="expensiveMode" class="mode-indicator mode-inactive">üíé</span>
          <span id="turboMode" class="mode-indicator mode-inactive">üöÄ</span>
          <span id="stealthMode" class="mode-indicator mode-inactive">ü•∑</span>
        </div>
      </div>

      <div class="control-panel">
        <h3>Manage Links</h3>
        <button onclick="openModal()">Dodaj link</button>
        <ul id="linksList" class="links-list"></ul>
      </div>

      <div class="control-panel">
        <h3>ü§ñ AI Chat</h3>
        <div id="chatWindow"></div>
        <input id="commandInput" placeholder="Wpisz komendƒô..." onkeydown="if(event.key==='Enter')sendAICommand()" />
        <button onclick="sendAICommand()">Wy≈õlij</button>
      </div>
    </div>
  </div>

  <div id="linkModal">
    <div class="modal-content">
      <h2>Dodaj nowy link</h2>
      <input id="modalNetwork" placeholder="Nazwa sieci" />
      <input id="modalUrl" placeholder="URL z {SOURCE_ID}/{CLICK_ID}" />
      <div style="text-align:right;">
        <button onclick="saveLink()">Zapisz</button>
        <button onclick="closeModal()">Anuluj</button>
      </div>
    </div>
  </div>

  <div id="confetti" class="confetti"></div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let chart, chartData = [], clickCount = 0;

    function initChart(){
      const ctx = document.getElementById('revenueChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
         { labels: [], datasets: [{ label: 'Revenue',  [], borderColor: 'rgb(75,192,192)', backgroundColor: 'rgba(75,192,192,0.1)' }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    function appendMessage(who, msg){
      const chat = document.getElementById('chatWindow');
      const d = document.createElement('div');
      d.innerHTML = `<strong>[${new Date().toLocaleTimeString()}] ${who}:</strong> ${msg}`;
      chat.appendChild(d); chat.scrollTop = chat.scrollHeight;
    }

    async function sendAICommand(cmd){
      const input = document.getElementById('commandInput');
      let text = cmd || input.value.trim();
      if(!text) return;
      input.value = '';
      appendMessage('User', text);
      if(text.toLowerCase() === 'help'){
        appendMessage('AI', 'Komendy: toggle_expensive, toggle_turbo, toggle_stealth, set_click_rate <0.05-0.80>, boost, reset');
        return;
      }
      try{
        const [action, value] = text.split(' ');
        const res = await fetch('/command', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({action, value}) });
        const data = await res.json();
        appendMessage('AI', data.message || JSON.stringify(data));
        updateModes(data);
      } catch {
        appendMessage('AI','B≈ÇƒÖd komunikacji');
      }
    }

    function updateModes(d){
      if(d.expensive_mode!==undefined) document.getElementById('expensiveMode').className = 'mode-indicator '+(d.expensive_mode?'mode-active':'mode-inactive');
      if(d.turbo_mode    !==undefined) document.getElementById('turboMode')   .className = 'mode-indicator '+(d.turbo_mode   ?'mode-active':'mode-inactive');
      if(d.stealth_mode  !==undefined) document.getElementById('stealthMode') .className = 'mode-indicator '+(d.stealth_mode?'mode-active':'mode-inactive');
    }

    async function fetchStats(){
      try{
        const res = await fetch('/stats'), d = await res.json();
        document.getElementById('imps').textContent    = d.imps.toLocaleString();
        document.getElementById('clicks').textContent  = d.clicks.toLocaleString();
        document.getElementById('ctr').textContent     = d.ctr+'%';
        document.getElementById('revenue').textContent = d.revenue.toFixed(2);
        const now = new Date().toLocaleTimeString();
        chartData.push({t: now, v: d.revenue});
        if(chartData.length>20) chartData.shift();
        chart.data.labels = chartData.map(o=>o.t);
        chart.data.datasets[0].data = chartData.map(o=>o.v);
        chart.update();
      }catch{}
    }

    async function manualScan(){
      await fetch('/scan',{method:'POST'});
      clickCount++; if(clickCount%3===0) launchConfetti();
      appendMessage('System','‚ö° MEGA SCAN');
      fetchStats();
    }

    function openModal(){ document.getElementById('linkModal').style.display='flex'; }
    function closeModal(){ document.getElementById('linkModal').style.display='none'; }

    async function saveLink(){
      const net = document.getElementById('modalNetwork').value.trim();
      const url = document.getElementById('modalUrl').value.trim();
      if(!net||!url){ alert('Wype≈Çnij oba pola'); return; }
      await fetch('/links',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({network:net,url:url})});
      closeModal(); loadLinks();
    }

    async function loadLinks(){
      const res = await fetch('/links'), arr = await res.json();
      const ul = document.getElementById('linksList'); ul.innerHTML = '';
      arr.forEach(l=>ul.innerHTML += `<li>#${l.id} ${l.network} [w=${l.weight.toFixed(2)}]<br><code>${l.url}</code></li>`);
    }

    function launchConfetti(){
      const c = document.getElementById('confetti');
      for(let i=0;i<50;i++){
        const p = document.createElement('div');
        p.className = 'confetti-piece';
        p.style.backgroundColor = `hsl(${Math.random()*360},70%,60%)`;
        p.style.left = `${Math.random()*100}%`;
        p.style.setProperty('--dx', (Math.random()*400-200)+'px');
        p.style.setProperty('--rot', (Math.random()*720)+'deg');
        p.style.animationDelay = (Math.random()*2)+'s';
        c.appendChild(p);
        setTimeout(()=>p.remove(),4000);
      }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      initChart(); fetchStats(); loadLinks();
      setInterval(fetchStats,3000); setInterval(loadLinks,5000);
    });
  </script>
</body>
</html>
